<h1>検定試験 第 <%= @kente_number.number %> 回 成績閲覧</h1>

<div class="container">
  <div class="mb-3 row align-items-center">
    <label for="kente_rank_select" class="col-sm-1 col-form-label">級位</label>
    <div class="col-sm-3">
      <%= select_tag :kente_rank_id, options_from_collection_for_select(@kente_ranks, :id, :rank), prompt: "級位を選択してください", class: "form-select", id: "kente_rank_select" %>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center">
      <thead class="table-light">
        <tr>
          <th scope="col" style="min-width: 130px;">生徒名</th>
          <th scope="col" style="width: 100px;">受験級</th>
          <th scope="col" style="width: 120px;">かけ算</th>
          <th scope="col" style="width: 120px;">わり算</th>
          <th scope="col" style="width: 120px;">みとり算</th>
          <th scope="col" style="width: 140px;">合計</th>
          <th scope="col" style="width: 100px;">合否</th>
        </tr>
      </thead>
      <tbody>
        <% @students.each do |student| %>
          <% kente = student.kentes.find_by(kente_number: @kente_number) %>
          <% examRank = @kente_ranks.find_by(id: kente.kente_rank) %>
          <% Rails.logger.debug("検定ランクは#{kente.kente_rank_id}") %>
          <tr data-kente-rank-id="<%= kente.kente_rank_id %>">
            <th class="text-start" scope="row"><%= "#{student.last_name} #{student.first_name}" %></th>
            <% if kente.present? %>
              <td><%= examRank.rank%></td>
              <td><%= kente.multiplication_score %></td>
              <td><%= kente.division_score %></td>
              <td><%= kente.mitori_score %></td>
              <td><%= kente.total_score %></td>
              <td>
                <%= kente.total_score >= examRank.passing_score ? "合格" : "不合格" %>
              </td>
              <% Rails.logger.debug(examRank.passing_score) %>
            <% else %>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="mt-3">
    <%= link_to "一覧へ戻る", admin_kentes_path, class: "btn btn-secondary" %>
    <%= link_to "編集", edit_admin_kente_path(@kente_number), class: "btn btn-primary me-2" %>
    <%= link_to "削除", admin_kente_path(@kente_number), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger" %>
  </div>
</div>
