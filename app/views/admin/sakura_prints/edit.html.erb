<h1>さくらプリントNo.<%=@print_number.number%> 成績編集</h1>

<%= form_with url: admin_sakura_print_path(@print_number), method: :patch, class: "container" do %>
  <div class="mb-3 row align-items-center">
    <label for="print_number" class="col-sm-2 col-form-label">プリント番号</label>
    <div class="col-sm-10 col-md-4">
      <%= number_field_tag :print_number, @print_number.number, class: "form-control", id: "print_number", readonly: true %>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center">
      <thead class="table-light">
        <tr>
          <th scope="col" style="min-width: 150px;">生徒名</th>
          <th scope="col" style="width: 120px;">かけ算</th>
          <th scope="col" style="width: 120px;">わり算</th>
          <th scope="col" style="width: 120px;">みとり算</th>
          <th scope="col" style="width: 140px;">みとり暗算</th>
        </tr>
      </thead>
      <tbody>
        <% @students.each do |student| %>
          <tr>
            <th class="text-start" scope="row"><%= "#{student.last_name} #{student.first_name}" %></th>
            <% prints = student.sakura_prints.where(sakura_print_number: @print_number) %>
            <% if prints.any? %>
              <% prints.each do |print| %>
                <%= fields_for "students[#{student.id}][sakura_prints][]", print do |sp_form| %>
                  <td><%= sp_form.number_field :multiplication_score, class: "form-control form-control-sm", required: true %></td>
                  <td><%= sp_form.number_field :division_score, class: "form-control form-control-sm", required: true %></td>
                  <td><%= sp_form.number_field :mitori_score, class: "form-control form-control-sm", required: true %></td>
                  <td><%= sp_form.number_field :mitori_anzan_score, class: "form-control form-control-sm", required: true %></td>
                <% end %>
              <% end %>
            <% else %>
              <%= fields_for "students[#{student.id}][sakura_prints][]", student.sakura_prints.build do |sp_form| %>
                <td><%= sp_form.number_field :multiplication_score, class: "form-control form-control-sm" %></td>
                <td><%= sp_form.number_field :division_score, class: "form-control form-control-sm" %></td>
                <td><%= sp_form.number_field :mitori_score, class: "form-control form-control-sm" %></td>
                <td><%= sp_form.number_field :mitori_anzan_score, class: "form-control form-control-sm" %></td>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="d-grid gap-2 col-6 mx-auto mt-3">
    <%= submit_tag "成績を登録", class: "btn btn-primary btn-lg" %>
  </div>
<% end %>
